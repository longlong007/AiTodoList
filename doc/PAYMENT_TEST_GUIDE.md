# Pro会员功能测试指南

## 支付流程说明

### 1. 访问会员页面
打开浏览器访问：`http://localhost:5173/pricing`

### 2. 选择套餐
- 月度会员：¥19.90/月
- 季度会员：¥49.90/季度（推荐）
- 年度会员：¥149.90/年

### 3. 选择支付方式
- 支付宝
- 微信支付

### 4. 完成支付
1. 点击"确认支付"后会弹出模拟支付窗口
2. 在支付窗口点击"确认支付"
3. 页面会自动刷新，显示Pro会员状态

## 问题排查

### 支付成功后没有显示

1. **检查浏览器控制台**
   - 打开开发者工具（F12）
   - 查看Console标签页的日志
   - 查找"收到支付成功消息"或"轮询订单状态"

2. **检查后端日志**
   - 查看后端终端输出
   - 应该看到：
     ```
     收到支付完成请求: { orderNo: 'TD...' }
     开始处理支付完成: { orderNo: '...', tradeNo: '...' }
     订单状态已更新为PAID: ...
     用户会员状态已更新: { userId: '...', accountType: 'pro', ... }
     支付处理完成
     ```

3. **手动刷新页面**
   - 如果自动刷新没有触发，尝试手动刷新浏览器
   - 查看待办列表页面是否显示Pro徽章

4. **检查数据库**
   - 确认订单状态是否更新为 `paid`
   - 确认用户的 `accountType` 是否为 `pro`

## 测试AI分析功能

1. 添加一些待办事项
2. 访问 `http://localhost:5173/analysis`
3. 如果是Pro会员，应该看到AI分析结果
4. 如果是免费用户，应该看到升级提示

## 常见问题

### Q: 支付窗口被浏览器拦截
A: 允许浏览器弹出窗口权限，或直接在地址栏输入支付URL

### Q: 支付完成后页面没反应
A: 
1. 检查支付窗口是否成功通知父窗口（查看控制台）
2. 检查轮询是否正常工作
3. 手动刷新页面查看会员状态

### Q: 如何测试订单轮询
A: 
1. 打开支付窗口但不点击确认
2. 在另一个标签页直接访问 `/api/payment/mock-complete`
3. 观察原页面是否自动检测到支付成功

## 开发模式快捷测试

使用 Postman 或 curl 直接调用支付完成接口：

```bash
curl -X POST http://localhost:3000/api/payment/mock-complete \
  -H "Content-Type: application/json" \
  -d '{"orderNo":"YOUR_ORDER_NO"}'
```

然后在前端查看效果。

