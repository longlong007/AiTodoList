# æ•°æ®åº“æµ‹è¯•æ•°æ®è¯´æ˜

æœ¬ç›®å½•åŒ…å«TodoListé¡¹ç›®çš„æ•°æ®åº“è¡¨ç»“æ„å’Œæµ‹è¯•æ•°æ®è„šæœ¬ï¼Œæ–¹ä¾¿å¿«é€Ÿæ­å»ºæµ‹è¯•ç¯å¢ƒã€‚

## ğŸ“ æ–‡ä»¶è¯´æ˜

```
database/
â”œâ”€â”€ schema.sql              # æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰ï¼ˆåŒ…å«æ‰€æœ‰è¡¨å’Œ PDF å­—æ®µï¼‰
â”œâ”€â”€ seed.sql                # æµ‹è¯•æ•°æ®ï¼ˆéœ€è¦å…ˆæ›´æ–°å¯†ç å“ˆå¸Œï¼‰
â”œâ”€â”€ generate-passwords.js   # å¯†ç å“ˆå¸Œç”Ÿæˆå·¥å…·
â”œâ”€â”€ setup-all.sh           # ä¸€é”®å®‰è£…è„šæœ¬ (Linux/Mac) â­ æ¨è
â”œâ”€â”€ setup-all.bat          # ä¸€é”®å®‰è£…è„šæœ¬ (Windows) â­ æ¨è
â”œâ”€â”€ import.sh              # åˆ†æ­¥å¯¼å…¥è„šæœ¬ (Linux/Mac)
â”œâ”€â”€ import.bat             # åˆ†æ­¥å¯¼å…¥è„šæœ¬ (Windows)
â”œâ”€â”€ add-report-pdf-fields.sql  # PDF å­—æ®µè¿ç§»è„šæœ¬ï¼ˆä»…ç”¨äºæ—§æ•°æ®åº“å‡çº§ï¼‰
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆä¸€é”®å®‰è£…ï¼‰â­

### æ–¹æ³• 1ï¼šä½¿ç”¨ä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

**Windows:**
```cmd
cd database
setup-all.bat
```

**Linux/Mac:**
```bash
cd database
chmod +x setup-all.sh
./setup-all.sh
```

è¿™å°†è‡ªåŠ¨å®Œæˆï¼š
- âœ… åˆ›å»ºæ‰€æœ‰æ•°æ®åº“è¡¨ï¼ˆusers, todos, orders, reportsï¼‰
- âœ… æ·»åŠ  PDF å­˜å‚¨å­—æ®µï¼ˆpdfUrl, pdfKeyï¼‰
- âœ… å¯¼å…¥æµ‹è¯•æ•°æ®ï¼ˆ5ä¸ªæµ‹è¯•ç”¨æˆ·ï¼Œ290æ¡å¾…åŠï¼Œ5ä¸ªè®¢å•ï¼‰
- âœ… æ˜¾ç¤ºæµ‹è¯•è´¦å·ä¿¡æ¯

âš ï¸ **è­¦å‘Š**ï¼šè„šæœ¬ä¼šåˆ é™¤å¹¶é‡å»ºæ‰€æœ‰è¡¨ï¼Œç°æœ‰æ•°æ®å°†ä¸¢å¤±ï¼

---

## ğŸ”§ åˆ†æ­¥å®‰è£…ï¼ˆæ—§æ–¹æ³•ï¼‰

### 1. ç”Ÿæˆå¯†ç å“ˆå¸Œï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

æµ‹è¯•æ•°æ®ä¸­çš„ç”¨æˆ·å¯†ç éœ€è¦ä½¿ç”¨bcryptåŠ å¯†ã€‚é¦–å…ˆç”Ÿæˆå¯†ç å“ˆå¸Œï¼š

```bash
# ç¡®ä¿å·²å®‰è£…ä¾èµ–
cd backend
npm install

# è¿è¡Œå¯†ç ç”Ÿæˆè„šæœ¬
node ../database/generate-passwords.js
```

å°†ç”Ÿæˆçš„å¯†ç å“ˆå¸Œå¤åˆ¶åˆ° `database/seed.sql` æ–‡ä»¶ä¸­ï¼Œæ›¿æ¢å¯¹åº”çš„å ä½ç¬¦ï¼š
- `$2b$10$YourHashedPasswordHere1`
- `$2b$10$YourHashedPasswordHere2`
- `$2b$10$YourHashedPasswordHere3`
- `$2b$10$YourHashedPasswordHere4`

### 2. é…ç½®æ•°æ®åº“è¿æ¥

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡

```bash
# Linux/Mac
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=todolist
export DB_USER=postgres
export DB_PASSWORD=your_password

# Windows PowerShell
$env:DB_HOST="localhost"
$env:DB_PORT="5432"
$env:DB_NAME="todolist"
$env:DB_USER="postgres"
$env:DB_PASSWORD="your_password"
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨ .env æ–‡ä»¶

è„šæœ¬ä¼šè‡ªåŠ¨è¯»å– `backend/.env` æ–‡ä»¶ä¸­çš„é…ç½®ã€‚

### 3. å¯¼å…¥æ•°æ®

#### Linux/Mac

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x database/import.sh

# è¿è¡Œå¯¼å…¥è„šæœ¬
./database/import.sh
```

#### Windows

```cmd
# åŒå‡»è¿è¡Œ
database\import.bat

# æˆ–åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ
database\import.bat
```

#### æ‰‹åŠ¨å¯¼å…¥ï¼ˆä½¿ç”¨psqlï¼‰

```bash
# åˆ›å»ºè¡¨ç»“æ„
psql -h localhost -p 5432 -U postgres -d todolist -f database/schema.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®
psql -h localhost -p 5432 -U postgres -d todolist -f database/seed.sql
```

#### ä½¿ç”¨Dockerä¸­çš„PostgreSQL

```bash
# å¦‚æœä½¿ç”¨docker-composeå¯åŠ¨çš„PostgreSQL
docker-compose exec postgres psql -U postgres -d todolist -f /path/to/schema.sql
docker-compose exec postgres psql -U postgres -d todolist -f /path/to/seed.sql

# æˆ–ä»å®¿ä¸»æœºå¯¼å…¥
docker exec -i $(docker-compose ps -q postgres) psql -U postgres -d todolist < database/schema.sql
docker exec -i $(docker-compose ps -q postgres) psql -U postgres -d todolist < database/seed.sql
```

## ğŸ‘¥ æµ‹è¯•è´¦å·

å¯¼å…¥æˆåŠŸåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æµ‹è¯•è´¦å·ç™»å½•ï¼š

### 1. å…è´¹ç”¨æˆ·
- **é‚®ç®±**: `free@test.com`
- **å¯†ç **: `test123456`
- **ç‰¹ç‚¹**: å…è´¹è´¦æˆ·ï¼Œå¾…åŠäº‹é¡¹è¾ƒå°‘
- **ç”¨é€”**: æµ‹è¯•åŸºç¡€åŠŸèƒ½å’ŒProå‡çº§æµç¨‹

### 2. Proç”¨æˆ·ï¼ˆä¼šå‘˜æœ‰æ•ˆæœŸ1å¹´ï¼‰
- **æ‰‹æœº**: `13800138000`
- **å¯†ç **: `test123456`
- **ç‰¹ç‚¹**: æ´»è·ƒProä¼šå‘˜ï¼Œå¾…åŠäº‹é¡¹ä¸°å¯Œ
- **ç”¨é€”**: æµ‹è¯•ProåŠŸèƒ½ï¼ˆAIåˆ†æç­‰ï¼‰

### 3. Proç”¨æˆ·ï¼ˆä¼šå‘˜å³å°†åˆ°æœŸï¼‰
- **é‚®ç®±**: `pro@test.com`
- **å¯†ç **: `test123456`
- **ç‰¹ç‚¹**: ä¼šå‘˜5å¤©ååˆ°æœŸï¼Œæœ‰åˆ°æœŸæé†’ä»»åŠ¡
- **ç”¨é€”**: æµ‹è¯•ä¼šå‘˜åˆ°æœŸæé†’å’Œç»­è´¹æµç¨‹

### 4. è¿‡æœŸProç”¨æˆ·
- **é‚®ç®±**: `expired@test.com`
- **å¯†ç **: `test123456`
- **ç‰¹ç‚¹**: Proä¼šå‘˜å·²è¿‡æœŸ
- **ç”¨é€”**: æµ‹è¯•ä¼šå‘˜è¿‡æœŸåçš„åŠŸèƒ½é™åˆ¶

### 5. å¾®ä¿¡ç”¨æˆ·
- **å¾®ä¿¡OpenID**: `wx_test_openid_12345`
- **æ˜µç§°**: `å¾®ä¿¡ç”¨æˆ·å¼ ä¸‰`
- **ç‰¹ç‚¹**: é€šè¿‡å¾®ä¿¡ç™»å½•çš„ç”¨æˆ·
- **ç”¨é€”**: æµ‹è¯•å¾®ä¿¡ç™»å½•åŠŸèƒ½ï¼ˆéœ€æ¨¡æ‹Ÿï¼‰

## ğŸ“Š æµ‹è¯•æ•°æ®ç»Ÿè®¡

å¯¼å…¥å®Œæˆåçš„æ•°æ®æ¦‚è§ˆï¼š

- **ç”¨æˆ·æ•°**: 5
  - Proç”¨æˆ·: 3
  - å…è´¹ç”¨æˆ·: 2
  
- **å¾…åŠäº‹é¡¹æ•°**: 290æ¡
  - å…è´¹ç”¨æˆ·å°æ˜: 30æ¡
  - Proä¼šå‘˜å°çº¢: 120æ¡
  - Proä¼šå‘˜å°æ: 80æ¡
  - è¿‡æœŸä¼šå‘˜å°ç‹: 40æ¡
  - å¾®ä¿¡ç”¨æˆ·å¼ ä¸‰: 20æ¡
  
- **è®¢å•æ•°**: 5
  - å·²æ”¯ä»˜: 3æ¡
  - å¾…æ”¯ä»˜: 1æ¡
  - å·²å–æ¶ˆ: 1æ¡

### å¾…åŠäº‹é¡¹è¦†ç›–åœºæ™¯

1. **é‡è¦æ€§çº§åˆ«**: Aã€Bã€Cã€D å…¨è¦†ç›–
2. **ç´§æ€¥ç¨‹åº¦**: 1-5 å…¨è¦†ç›–
3. **çŠ¶æ€**: pendingã€in_progressã€completedã€cancelled å…¨è¦†ç›–
4. **æˆªæ­¢æ—¥æœŸ**: è¿‡æœŸã€å³å°†åˆ°æœŸã€æœªæ¥ã€æ— æˆªæ­¢æ—¥æœŸ
5. **å…¸å‹åœºæ™¯**: 
   - ç´§æ€¥Bugä¿®å¤
   - é¡¹ç›®æ¼”ç¤ºå‡†å¤‡
   - å­¦ä¹ è®¡åˆ’
   - ä»£ç é‡æ„
   - æ—¥å¸¸çäº‹

## ğŸ”§ æ•°æ®åº“è¡¨ç»“æ„

### users è¡¨
ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ŒåŒ…å«ï¼š
- åŸºæœ¬ä¿¡æ¯ï¼šæ‰‹æœºã€é‚®ç®±ã€æ˜µç§°ã€å¤´åƒ
- ç™»å½•æ–¹å¼ï¼šphoneã€emailã€wechat
- ä¼šå‘˜ä¿¡æ¯ï¼šè´¦æˆ·ç±»å‹ã€è®¢é˜…çŠ¶æ€ã€åˆ°æœŸæ—¶é—´

### todos è¡¨
å¾…åŠäº‹é¡¹è¡¨ï¼ŒåŒ…å«ï¼š
- å†…å®¹ï¼šæ ‡é¢˜ã€æè¿°
- ä¼˜å…ˆçº§ï¼šé‡è¦æ€§ï¼ˆA-Dï¼‰ã€ç´§æ€¥ç¨‹åº¦ï¼ˆ1-5ï¼‰
- çŠ¶æ€ï¼špendingã€in_progressã€completedã€cancelled
- æ—¶é—´ï¼šæˆªæ­¢æ—¥æœŸã€å®Œæˆæ—¶é—´

### orders è¡¨
è®¢å•è¡¨ï¼ŒåŒ…å«ï¼š
- è®¢å•ä¿¡æ¯ï¼šè®¢å•å·ã€é‡‘é¢ã€å¥—é¤ç±»å‹
- æ”¯ä»˜ä¿¡æ¯ï¼šæ”¯ä»˜æ–¹å¼ã€äº¤æ˜“å·ã€æ”¯ä»˜æ—¶é—´
- çŠ¶æ€ï¼špendingã€paidã€failedã€refundedã€cancelled

## ğŸ”„ é‡ç½®æ•°æ®åº“

å¦‚æœéœ€è¦é‡ç½®æ•°æ®åº“åˆ°åˆå§‹çŠ¶æ€ï¼Œå¯ä»¥ï¼š

### æ–¹å¼ä¸€ï¼šé‡æ–°è¿è¡Œä¸€é”®å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
cd database
./setup-all.sh  # Linux/Mac
setup-all.bat   # Windows
```

### æ–¹å¼äºŒï¼šè¿è¡Œåˆ†æ­¥å¯¼å…¥è„šæœ¬

```bash
cd database
./import.sh  # Linux/Mac
import.bat   # Windows
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨é‡ç½®

```bash
# åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆä¿ç•™è¡¨ç»“æ„ï¼‰
psql -U postgres -d todolist -c "TRUNCATE TABLE orders, todos, users CASCADE;"

# é‡æ–°å¯¼å…¥æµ‹è¯•æ•°æ®
psql -U postgres -d todolist -f database/seed.sql
```

### æ–¹å¼ä¸‰ï¼šå®Œå…¨é‡å»º

```bash
# åˆ é™¤æ‰€æœ‰è¡¨å’Œæ•°æ®
psql -U postgres -d todolist -f database/schema.sql

# å¯¼å…¥æµ‹è¯•æ•°æ®
psql -U postgres -d todolist -f database/seed.sql
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

1. **å¼€å‘ç¯å¢ƒ**ï¼šä½¿ç”¨æµ‹è¯•æ•°æ®å¿«é€ŸéªŒè¯åŠŸèƒ½
2. **æ¼”ç¤ºç¯å¢ƒ**ï¼šå±•ç¤ºå®Œæ•´çš„åŠŸèƒ½å’Œæ•°æ®åœºæ™¯
3. **æµ‹è¯•ç¯å¢ƒ**ï¼šæ¯æ¬¡æµ‹è¯•å‰é‡ç½®åˆ°å·²çŸ¥çŠ¶æ€
4. **ç”Ÿäº§ç¯å¢ƒ**ï¼šâš ï¸ **è¯·å‹¿**å¯¼å…¥æµ‹è¯•æ•°æ®

## ğŸ› å¸¸è§é—®é¢˜

### Q1: å¯¼å…¥æ—¶æç¤º "psql: command not found"

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®‰è£…PostgreSQLå®¢æˆ·ç«¯å·¥å…·
- å°†PostgreSQLçš„binç›®å½•æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡

### Q2: å¯†ç éªŒè¯å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ç¯å¢ƒå˜é‡ `DB_PASSWORD` æ˜¯å¦æ­£ç¡®
- æˆ–åœ¨è¿è¡Œpsqlæ—¶æ‰‹åŠ¨è¾“å…¥å¯†ç 

### Q3: ç”¨æˆ·æ— æ³•ç™»å½•

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²è¿è¡Œ `generate-passwords.js` ç”Ÿæˆå¯†ç å“ˆå¸Œ
- ç¡®ä¿å·²å°†ç”Ÿæˆçš„å“ˆå¸Œå€¼æ›´æ–°åˆ° `seed.sql` æ–‡ä»¶ä¸­
- é‡æ–°å¯¼å…¥æ•°æ®

### Q4: æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥æ•°æ®åº“åç§°ã€ç«¯å£æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### Q5: ä¸­æ–‡æ˜¾ç¤ºä¹±ç 

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# è®¾ç½®å®¢æˆ·ç«¯ç¼–ç ä¸ºUTF-8
psql -U postgres -d todolist -c "SET CLIENT_ENCODING TO 'UTF8';"
```

## ğŸ“ è‡ªå®šä¹‰æµ‹è¯•æ•°æ®

å¦‚æœéœ€è¦æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•æ•°æ®ï¼š

1. **ç¼–è¾‘ `seed.sql`**ï¼šæ·»åŠ æ–°çš„INSERTè¯­å¥
2. **ä¿æŒä¸€è‡´æ€§**ï¼šç¡®ä¿å¤–é”®å…³ç³»æ­£ç¡®ï¼ˆuserIdç­‰ï¼‰
3. **æ³¨æ„æ—¶é—´**ï¼šä½¿ç”¨ç›¸å¯¹æ—¶é—´ï¼ˆNOW() + INTERVALï¼‰ä¿æŒæ•°æ®æ–°é²œåº¦
4. **é‡æ–°å¯¼å…¥**ï¼šè¿è¡Œå¯¼å…¥è„šæœ¬åº”ç”¨æ›´æ”¹

## ğŸ” å®‰å…¨æç¤º

1. âš ï¸ æµ‹è¯•å¯†ç  `test123456` ä»…ç”¨äºå¼€å‘/æµ‹è¯•ç¯å¢ƒ
2. âš ï¸ ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨å¼ºå¯†ç 
3. âš ï¸ ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
4. âš ï¸ å®šæœŸæ›´æ¢ç”Ÿäº§ç¯å¢ƒçš„æ•°æ®åº“å¯†ç 

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [NestJS TypeORM](https://docs.nestjs.com/techniques/database)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [bcrypt](https://github.com/kelektiv/node.bcrypt.js)

---

æœ€åæ›´æ–°ï¼š2026-01-04

